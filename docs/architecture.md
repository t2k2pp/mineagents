# MyEnvironment システムアーキテクチャ (Blueprint)

このドキュメントは、このリポジトリ「MyEnvironment」自体の設計思想と基本アーキテクチャを定義する青写真（Blueprint）です。

## 1. コア・アーキテクチャ: Zero-config Orchestration
本環境は単なるテンプレート集ではなく、「PM（メインエージェント）と SubAgents（各専門エージェント群）」によるオーケストレーションシステムとして動作します。

- **PM（Orchestrator）**: `.cursorrules` 等によって定義される。自らは直接コードを書かず、常にタスクを分解し、サブエージェントを呼び出し、進行を監視（Steering）する責任を持つ。
- **SubAgents**: `templates/subagents/` に格納される。各フェーズや技術スタックに特化したプロンプトで別プロセスとして起動され、実作業を行う。

## 2. コンテキスト節約メカニズム (Dynamic Loading)
すべてのエージェントテンプレートを読み込むことによるコンテキスト窓の浪費を防ぐため、以下の仕組みを持ちます。
- **`catalog.yaml`**: 全コンポーネントのインデックス。
- **`context-manager` サブエージェント**: PMに代わって `catalog.yaml` を読み込み、現在の状況（言語、フェーズ）に必要なファイル一覧だけを抽出・返却する専用エージェント。

## 3. 二元共有記憶 (Dual Shared Memory) パターン
分離されたサブエージェント同士、またはPMとの間での「コンテキスト喪失（サイロ化）」を防ぐため、2つのマークダウンファイルを共有黒板（Blackboard）として利用します。

1. **Blueprint領域** (`docs/architecture.md` 等)
   - システム全体の設計・構成・データベーススキーマなど、「変わらない（合意された）状態」を永続化する。
   - サブエージェントは設計変更時に必ずここを更新する。
2. **Ticket領域** (`.agent/tickets.md` 等)
   - エージェント間の依頼事項、ブロッカー、引き継ぎ事項などを動的に書き込む掲示板。
   - **PMエージェント**は定期的にここを監視し、長時間滞っているチケットがあれば該当サブエージェントを再起動させて問題解決（掘り起こし）を行う責任を持つ。

## 初期設計時のメモ (History)
- 当初は `context-manager` をただのスキルとして提供する予定だったが、メインエージェントのコンテキスト浪費を防ぐため「独立したサブエージェント」へと昇格させた。
- さらに、サブエージェント間で連携が取れなくなる問題を解消するため、Redmine的なチケット管理＋設計図の二元管理に落ち着いた。（ユーザーとの対話より策定）
