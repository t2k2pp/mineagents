---
name: shared_memory
description: サブエージェント間のサイロ化を防ぐため、青写真（Blueprint）とチケット（Ticket）を用いた「二元共有記憶（Dual Shared Memory）」の運用ルールを定義する。
model: [claude-3-5-sonnet-20241022 等]
---

# 共有記憶 (Dual Shared Memory) 運用ルール

マルチエージェント環境において、各エージェントのコンテキスト（記憶）は**別々のプロセス（サイロ）**として独立しています。
異なる役割を持つサブエージェント同士、およびPM（メインエージェント）がスムーズに非同期連携を行うため、このプロジェクトでは**ファイルシステムを用いた2つの共通黒板（Blackboard）**を利用します。

## 1. Blueprint（青写真）領域
**目的**: 「現在合意されているシステム全体の設計・仕様・状態」を永続化する場所。
**配置例**: `docs/architecture.md`, `docs/database_schema.md` 等

- **利用ルール**:
  - 全エージェントは、作業着手前に必ず該当するBlueprintを参照し、システムの前提条件を理解しなければならない。
  - 設計の変更、API仕様の追加、新しいライブラリの採用など、**システムの状態が変化した場合は、作業完了時に必ずBlueprintを自己更新（ファイル書き込み）**しなければならない。

## 2. Ticket（チケット/掲示板）領域
**目的**: 「エージェント間のコミュニケーション、依頼事項、完了報告、ブロック要因の共有」を行う動的な場所。
**配置例**: `.agent/tickets.md`, `.agent/tasks.md`

- **利用ルール**:
  - **依頼と着手**: PMエージェントはサブエージェントを呼ぶ際、直接プロンプトに長文を書くのではなく「要件は `.agent/tickets.md` のチケットID[#123]に記載した」と指示を出す。
  - **完了と引き継ぎ**: サブエージェントは作業完了時、標準出力にダラダラと経緯を書かず、**必ずこのTicketファイルに「完了報告」や「次の担当者への引き継ぎ事項・注意事項」を追記**してから終了する。
  - **ブロックの報告**: APIエラー等で作業が継続できない場合も、Ticketファイルに「[BLOCKED] 理由：〜」と記載する。

## 3. PM（オーケストレーター）の監視責任
PMエージェント（メインプロセス）の最も重要な役割の一つは、**Ticket領域の監視と滞った作業の掘り起こし**です。

- サブエージェントが依頼したタスクをやっていない（Ticketが更新されない）。
- Ticketに「BLOCKED」と記載されたまま放置されている。
- コミュニケーションの齟齬で実装が止まっている。
このような「誰も見ていない・無視されている領域」を発見した場合、**PMは能動的に該当のサブエージェントを再起動し、「チケット[#123]が滞っているが、原因を調査し解決せよ」と介入（割り込み）しなければなりません。**
